% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tvfit.R
\name{tvfit}
\alias{tvfit}
\title{Time-varying VAR estimation (ML or EM)}
\usage{
tvfit(
  data,
  p = 1,
  r = 1,
  zero.mean = TRUE,
  factor.structure = NULL,
  method = c("ML", "EM"),
  control = list(maxit = 2000, trace = 0),
  em_control = list(max_iter = 200, tol = 0.001, trace = TRUE),
  init = c("default", "random", "custom"),
  init_list = NULL
)
}
\arguments{
\item{data}{Numeric matrix \code{T x N} (rows = time, cols = variables).}

\item{p}{Integer VAR lag order.}

\item{r}{Integer number of latent factors (state dimension).}

\item{zero.mean}{Logical; if \code{TRUE}, intercepts in \eqn{\Phi^c} are fixed at 0.}

\item{factor.structure}{Structure specification for Φᶠ (the factor loading component).

Defines which autoregressive coefficients vary with each latent factor.
Each element of \code{factor.structure} indicates whether a coefficient is
estimated (\code{1}) or restricted to zero (\code{0}). The user can supply:
\itemize{
\item a single matrix of dimension N×N (applied to all factors), or
\item a list/array of r such matrices, one per factor.
}

By default, all parameters are estimated (i.e., a full matrix of ones).
This corresponds to an unrestricted specification where all loadings are
free, subject to the identification rule below.

The identification condition requires that the first r×r block of the
corresponding factor-loading matrix (Λ₀) can be permuted into a
lower-triangular form with strictly positive diagonal elements.
Internally, \code{tvfit()} checks whether such a permutation exists.
If not, the function terminates with an informative error.

Users can also call \code{\link{init.factor.structure}()} to generate a
minimally identified default structure that automatically satisfies
these restrictions.}

\item{method}{One of \code{"ML"} (direct BFGS on likelihood) or \code{"EM"}.}

\item{control}{List of optimizer controls passed to ML (e.g. \code{list(maxit=2000, trace=0)}).}

\item{em_control}{List of EM controls
(e.g. \code{list(max_iter=200, tol=1e-3, trace=TRUE)}).}

\item{init}{Initialization mode: \code{"default"}, \code{"random"}, or \code{"custom"}.
See Details.}

\item{init_list}{Named list of custom initial values used when \code{init="custom"}.
Recognized elements: \code{A}, \code{B}, \code{phi_r}, \code{Omega} (\eqn{N \times N}),
\code{Phi_c} (\eqn{N \times (1+Np)} or \eqn{N \times Np} if \code{zero.mean=TRUE}),
and \code{Phi_f} (vector for the free \eqn{\Phi^f} entries in mask order).}
}
\value{
A \code{tvfit} list (same structure as from \code{tvpenfit()}).
}
\description{
Fits a time-varying VAR (TV–VAR) using either direct maximum likelihood (ML)
or an EM routine, without sparsity penalties. Produces an object compatible
with downstream functions such as \code{\link[=tvirf]{tvirf()}} and \code{\link[=tvpred]{tvpred()}}.
}
\details{
Identification follows the standard dynamic factor model convention:
factors are ordered and scaled such that Λ₀ is lower-triangular with
positive diagonal elements. This ensures uniqueness of the factor space
up to labeling.

Users may impose additional zeros on the factor structure to restrict
certain loadings, provided the identification condition still holds.
The internal \code{check_identification()} function verifies this
automatically when \code{tvfit()} runs.

Initialization:
\itemize{
\item \strong{default}: \eqn{A=0.10}, \eqn{B=0.80}, \eqn{\phi_r=0.95}, \eqn{\Omega} with
0.3 on diagonal and 0.2 off-diagonal, and small 0.01 values for free \eqn{\Phi^f}.
\eqn{\Phi^c} is initialized via a static VAR (Gorgi-style), respecting \code{zero.mean}.
\item \strong{random}: draws reasonable random starting values (bounded and PD).
\item \strong{custom}: take values from \code{init_list} (fallback to defaults if a field is missing).
}

The returned object has class \code{"tvfit"} and contains:
\itemize{
\item \code{$estimate}: list with \code{A}, \code{B}, \code{phi_r}, \code{Phi_f}, \code{Phi_c}, \code{Omega}.
\item \code{$lik}: average and summed log-likelihood.
\item \code{$ic}: AIC, AICc, BIC (computed in the usual unpenalized way).
\item \code{$eval}: last evaluation bundle (e.g., filtered states).
\item \code{$optim}: optimizer details.
\item \code{$vcov}: asymptotic covariance matrix (if computed in your ML core).
\item \code{$theta}: final parameter vector (unconstrained scale).
\item \code{$meta}: dims, method, free pattern, and \code{time} (runtime in seconds).
}
}
\examples{
\dontrun{
# ML with default init
fit_ml <- tvfit(
  data = simdata$Y, p = 1, r = 1, zero.mean = TRUE,
  factor.structure = matrix(1, 2, 2), method = "ML"
)

# EM with random init
fit_em <- tvfit(
  data = simdata$Y, p = 1, r = 1, zero.mean = TRUE,
  factor.structure = matrix(1, 2, 2), method = "EM",
  init = "random"
)

# ML with custom init for A and B only (others fall back to defaults)
fit_ml_custom <- tvfit(
  data = simdata$Y, p = 1, r = 1, zero.mean = TRUE,
  factor.structure = matrix(1, 2, 2), method = "ML",
  init = "custom", init_list = list(A = 0.2, B = 0.7)
)
}
}
\seealso{
\code{\link{tvpenfit}} for the penalized version, where the user must
manually ensure identification by ordering the factors appropriately.

\code{\link[=tvpenfit]{tvpenfit()}}, \code{\link[=tvirf]{tvirf()}}, \code{\link[=tvpred]{tvpred()}}
}
